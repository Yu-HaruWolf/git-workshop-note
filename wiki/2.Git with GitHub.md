# What is GitHub?
GitHubはソフトウェア開発のプラットフォームで、ソースコードをホスティングしてくれます。コードのバージョン管理システムにGitを使用しており、オンライン上のリポジトリ(リモートリポジトリ)としても使用できます。<br>
<img src="https://raw.githubusercontent.com/Yu-HaruWolf/git-workshop-note/349ec9eda546dcc039cb4c651d051e7cdd9bc817/images/git_collaborate_image_diagram.png" height="300px" alt="Git collaborate image"><br>
単にホスティングを行ってくれるだけではなく、コードのレビューや、プロジェクト管理、ドキュメント管理、継続的インテグレーションなど、開発を行う上で様々な所でサポートを行ってくれます。最近では、AIを活かしたCopilot機能もリリースされています。今回は入門者/初心者向けなのでこのような内容は扱いませんが、興味がある方はぜひ調べてみてください。<br>
# 認証情報の設定
ターミナル経由で既に認証ができるようになっている方はこの章を読み飛ばしていただいて大丈夫です。

 早速、GitHubで作成したリポジトリをホストしてみましょう！と行きたいですが、Web経由だけでなく、ターミナル経由でも自分が誰なのかをGitHubに認識してもらう必要があります。なのでまずは認証情報の設定から行きましょう。<br>
GitHubでは安全性の観点から、ターミナル経由のパスワードログインを廃止しています。そのため、ターミナル用に認証情報を作成する必要があります。<br>
認証情報の作成例として以下のものがあります。
- github.comにアクセスし、アクセストークンを発行し、パスワードの代わりとして認証を行う
- SSHの公開鍵をGitHubに登録し、SSH経由で認証を行う

## SSH経由で認証する
今回はSSH経由(SSH公開鍵認証)で認証できるようにしたいと思います。<br>
SSH公開鍵認証では公開鍵と秘密鍵の2つの鍵がセットとなって認証を行います。<br>
SSH公開鍵認証の仕組みの話をすると、Gitの話から逸れるので細かい説明はしませんが、公開鍵をサーバーに登録し、パソコンに保存している秘密鍵と組み合わせて認証を行います。<br>

まずは、次のコマンドで秘密鍵と公開鍵のペアを作成します。<br>
```bash
ssh-keygen
```
この後に鍵の保存場所を聞かれますが、特に何も入力せずにEnterで進めて大丈夫です。デフォルトの場所に保存されます。<br>
続いてパスフレーズを聞かれますが、こちらも今回は空白で大丈夫です。セキュリティをより強化したい場合は設定しておくと良いでしょう。<br>
これで、保存場所を指定していない場合は、ホームディレクトリの.sshにid_rsaとid_rsa.pubの2つのファイルが作成されます。語尾に.pubがついている方が公開鍵です。もう1つは秘密鍵で、こちらは正しく保管される必要があります。(パスワードのようなものです。)<br>
公開鍵の方ですが、こちらはアクセスするサーバー側に渡しておく必要が洗います。今回はGitHubに登録しておく必要があります。<br>
GitHubに公開鍵を追加するには、右上のプロフィールアイコンをクリックし、「Settings」に進みます。<br>
左のメニューに「SSH and GPG keys」という項目があるのでクリックします。「New SSH key」をクリックし、「Key」の欄に公開鍵を入れてください。「Title」には公開鍵がどの端末のものであるか等がわかりやすいように入力してください。「Key type」は「Authentication Key」のままで大丈夫です。<br>
<img src="https://github.com/Yu-HaruWolf/git-workshop-note/blob/main/images/github_new_ssh_key.png?raw=true"><br>
<img src="https://github.com/Yu-HaruWolf/git-workshop-note/blob/main/images/github_add_new_ssh_key.png?raw=true">
なお、公開鍵の情報は次のコマンドで取得できます。表示された内容をコピーペーストしてください。<br>
```bash
cat ~/.ssh/id_rsa.pub
```
公開鍵が正しく登録かを確認するには、ターミナルで次のコマンドを実行します。
```bash
ssh git@github.com
```
正しく公開鍵が登録されていれば、自身のユーザー名が返ってきます。<br>
もし、`Are you sure you want to continue connecting (yes/no/[fingerprint])?`と表示されていたらyesと入力してEnterを押してください。(接続しようとしているサーバーが正しいものであるかの確認です。)


# The vocabulary in Git
ローカルで使用する語彙は既に触れましたが、リモートで使用する語彙がまだなので、ここで確認していきましょう。
## local / remote
gitにはローカルリポジトリとリモートリポジトリの2種類があり、これにより分散型の管理を実現しています。手元の端末上にあるリポジトリがローカルリポジトリ、GitHub等のサーバーで管理しているリポジトリがリモートリポジトリになります。
## clone
リモートリポジトリをローカルリポジトリにコピーをします。まだ、ローカルリポジトリで作業をしていない場合に使用します。
## push
ローカルリポジトリの内容をリモートリポジトリにアップロードすることです。
## fetch
リモートリポジトリからローカルリポジトリに変更内容を情報として同期させることです。

# Let's try GitHub!

## 作ったリポジトリをGitHubにアップロードする
### GitHubのリモートリポジトリを設定する

GitHubにリポジトリをアップロードできるように、まずはGitHub側の準備を整えましょう。<br>
<img src="https://raw.githubusercontent.com/Yu-HaruWolf/git-workshop-note/main/images/github_home_to_create_repository.png" alt="GitHub Home and click New"><br>
GitHubの[Dashboard](https://github.com)へ行くと、画面左上に緑色のNewと書いてあるボタンがあるのでクリックします。<br>
<img src="https://raw.githubusercontent.com/Yu-HaruWolf/git-workshop-note/main/images/github_create_repository.png" alt="GitHub create repository"><br>
次の画面で、リポジトリ名と、公開するかどうかを設定します。<br>リポジトリ名はGitHubからランダムに提案されたものも選ぶことができます。<br>公開設定に関しては、チーム内だけで共有したいものはPrivateで設定しておくと良いでしょう。<br>
他にもREADMEを追加するかや、gitignoreについてもここで設定できますが、まだ触れていない内容なのでここでは無視します。<br>
設定ができたらCreate repositoryをクリックしてください。<br>
<img src="https://raw.githubusercontent.com/Yu-HaruWolf/git-workshop-note/main/images/github_get_repository_link.png" alt="GitHub get a repository url"><br>
リポジトリを作成できたら、リモートリポジトリとしてアクセスするためのURLを取得します。<br>
アクセストークンでの認証の場合はHTTPS、SSH認証の場合はSSHのURLをコピーしてください。<br>

URLが取得できたらシェルに戻ってリモートリポジトリを追加します。<br>
リモートリポジトリの追加は以下のコマンドで行います。<br>
```bash
git remote add origin <URL>
```
originはローカルでリモートリポジトリを識別するための名前です。一般的にoriginが使われることが多いです。<br>
複数のリモートリポジトリを1つのローカルリポジトリで使う場合は名前を変えることがあります。<br>
\<URL>は取得したURLに置き換えてください。<br>
### ブランチ名を変更する
これでpushが既にできる状態なのですが、ここでブランチ名の変更を行います。<br>
なぜこのタイミングでブランチ名の変更を行うのかと言うと、Gitのデフォルトブランチ名とGitHubのデフォルトのブランチ名が違うからです。<br>
GitHubも元々デフォルトのブランチ名がmasterだったのですが、様々な背景からmainに変更されたようです。<br>
ブランチ名の変更は頻繁にするべきものではないので、サクッと変えて先に進みましょう。<br>
ブランチ名の変更は変更するブランチを有効にした状態で、以下のコマンドで行います。<br>
```bash
git branch -m main
```
### pushする
リモートリポジトリの追加とブランチ名の変更ができたらいよいよpushします。<br>
pushは以下のコマンドで行います。<br>
```bash
git push --set-upstream origin main
```
コマンドの内容はoriginとして設定されているリモートリポジトリに、mainブランチをpushするということになります。<br>
`--setup-stream`というオプションが指定されていますが、これはmainブランチのデフォルトのpush先としてoriginを指定しておくという意味になります。これで次回以降は`git push`だけでpushできるようになります。

### pushした内容をWeb上で確認する。
GitHub上で作成したリポジトリのページを開いていますか？まだ開いている場合は再読み込みしましょう。<br>
もし閉じてしまった場合は、[github.com](https://github.com)にアクセスして、ページの左からリポジトリを選択してください。<br>
pushした内容がWeb上で確認できましたか？

### 変更内容を確認する。
<img src="https://raw.githubusercontent.com/Yu-HaruWolf/git-workshop-note/main/images/git_code_commit.png" alt="GitHub point commit"><br>
ファイル一覧の右上にある~ commitsをクリックしてみましょう。過去のコミット履歴を見ることができます。また、各コミットの変更内容を確認することもでできます。<br>
ただコミット1つ1つを見ていくのは大変なので、コミットメッセージでしっかりと伝わるようにすることを意識していきましょう。<br>

なお、コミットメッセージは1行だけではなく、複数行設定することができます。<br>
以下のようにメッセージの引数を複数作ることで、複数行設定できます。
```bash
git commit -m "Commit message" -m "" -m "Description of commit"
```
なお、一般的に1行目にコミット内容の簡潔な説明をし、2行目は空行にし、3行目以降で具体的な説明を行います。<br>
GitHub上で表示されるのは1行目のコミットメッセージが主に表示され、3行目以降はコミットの詳細を確認した際に表示されます。

## リポジトリをcloneする
作成したリモートリポジトリを別の人/パソコンにcloneしてみましょう。とはいえ、いきなり別の人やパソコンを用意するのは大変なので、今回は別のフォルダにクローンすることにしましょう。(ローカルリポジトリはフォルダに.gitフォルダを生成して管理するのでこの方法でも競合する等は発生しないはずです。普通はしません。)<br>
cloneを行う前に、必ずリポジトリから作業ディレクトリを外しておいてください。<br>
リモートリポジトリをローカルにクローンするには以下のコマンドを実行します。
```bash
git clone <URL> <directory name>
```
\<directory name>は省略可能です。省略した場合は、リポジトリ名が使用されます。クローンするためのフォルダは空であることが必須です。<br>
同じリポジトリが2つになりましたか？なお、cloneしたリポジトリにはあらかじめremoteのoriginにcloneで使用したURLが設定されています。(設定されていないパターンがあるらしいです。未検証。)

## 変更をリモートリポジトリ経由で反映する
GitHubにリポジトリをアップロードし、ローカルにも2つのリポジトリができたので、リモート経由で変更を反映してみましょう。<br>
本来であれば、誰かが変更を加えてくれるものですが、今回は自分自身で加えることにしましょう。<br>
次の作業のために以下のことを行ってください。<br>
- 1つ目のリポジトリで変更を加え、commitし、pushまで行ってください。
- 2つ目のリポジトリで変更を加えてcommitしてください。(pullやpushはしなくて大丈夫です。この後やります。)

変更を加えコミットをできたところで、2つ目のリポジトリに1つ目のリポジトリで行った変更を反映させることを考えましょう。現時点では、リモートリポジトリ上にpushされた変更内容がローカルにたどり着いていないので、変更情報をリモートリポジトリとローカルリポジトリで同期させます。<br>
変更情報の同期は以下のコマンドで実行できます。
```bash
git fetch
```
同期ができると、追加された情報が出力されます。<br>
`git status`を実行すると、リモートとローカルの間に何コミット分差があるのかも確認することができます。<br>
ただ、このままの状態だと変更した情報がローカルに来ただけで、作業内容に反映されていないので、反映された後から作業するためには、mergeする必要があります。この時にmergeコマンドを使用する場合は、ブランチ名等を指定しないで大丈夫です。
```bash
git merge
```
ここでCONFLICTが発生した場合は、解決を行いましょう。<br>
なお、CONFLICTが発生した箇所全てで作業中だったものを使用したい場合は以下のコマンドでも解決することができます。
```bash
git checkout --ours
```
逆に、マージしようとしている方の内容を残したい場合は、以下のコマンドで解決できます。
```bash
git checkout --theirs
```

ここまでの内容で、分散型のGitを利用できるようになりました。<br>
同じ動作を行いつつ、少し違うやり方も確認していきましょう。
- fetchとmergeをしたリポジトリで変更を加え、commit, pushしましょう。
- もう1つのリポジトリに移動します。新しい動作を確認するために、fetchとmergeはしないで進めましょう。
- 変更を加えましょう。新しい動作を確認するために、ファイルの保存のみをして、コミットせずに先に進みましょう。

## 変更を一時退避させる(Stash)

先程はfetchとmergeを分けて実行しましたが、これらのコマンドはよくセットで実行されます。なので、それ専用のコマンドが用意されています。
```bash
git pull
```
このコマンドを実行すると、fetchとmergeがセットで実行されます。<br>
ただし、このタイミングでpullを実行してもうまくmergeしてくれない可能性があります。<br>
未コミットの変更があることが理由ですね。今の段階ではそのままコミットしてしまっても問題ないかもしれませんが、実際の開発シチュエーションではそうとも限りません。<br>
ただし、リモートの変更はすぐに反映させたいと思うことがあります。<br>
その時に役に立つのがstashです。stashにはコミットするほどでもないけど、削除したくない変更を退避させておくことに使えます。早速退避させましょう<br>
現在コミットしていない変更をstashに退避させておくためには、次のコマンドを実行します。
```bash
git stash save <Stash name>
```
なお、\<Stash name>は省略可能です。省略した場合はstash@{0}のように、自動的に番号付きの名前が設定されます。<br>
stashに退避できているか、確認しましょう。
```bash
git stash list
```
stashに正しく退避できる場合は、次のように表示されます。
```
stash@{0}: WIP on main: 9e7db4c remove test.txt
```
`スタッシュ名: WIP on ブランチ名: ハッシュ値 コミットメッセージ`の形式で表示されています。<br>
以下のコマンドで、スタッシュに退避されている内容を表示できます。
```bash
git stash list --patch
```

スタッシュに退避させたものは使う際に復帰させる必要があります。<br>
次のコマンドで、stashに退避させたものを復元できます。
```bash
git stash apply <Stash name>
```
なお、\<Stash name>を省略した場合は、最新のstashが復元されます。<br>
このタイミングでCONFLICTが発生することもあります。<br>
ただし、このままだとstashに退避させていた内容が残ったままになってしまいます。<br>
少ないうちは良いですが、溜まっていくと整理がつかなくなってしまうので、必要がなくなったら削除しましょう。<br>
次のコマンドで、復元させたstashを削除します。<br>
```bash
git stash drop <Stash name>
```
こちらも、\<Stash name>が省略できますが、最新のstashが削除されるので注意して使用してください。<br>
なお、これらのコマンドはよく実行されるので、セットで実行できるようになっています。<br>
次のコマンドでスタッシュからポップすること(取り出して削除すること)ができます。<br>
```bash
git stash pop <Stash name>
```
なお、CONFLICTが発生した際は、再度必要になるときのために削除されないことがあります。<br>

## コミットに目印をつける(Tag)
バージョン管理を長く続けていると特定地点のコミットを覚えておきたいことがあります。そんなときに役に立つものがTagです。<br>
これは難しい話ではなく、コミットに目印をつけることができるというだけの話です。早速やってみましょう。<br>
次のコマンドでタグを作成します。
```bash
# 注釈を残さない場合
git tag <Tag name> <Commit>

# 注釈を残す場合(日付、著者、コメントが残ります)
git tag --annotate <Tag name> <Commit> --message <Comment>
```
\<Commit>は省略可能です。省略した場合は、現在のHEAD(作業直前のコミット)にタグが付けられます。<br>
作成したタグは次のコマンドで確認できます。
```bash
# タグの一覧
git tag

# タグの詳細
git show <Tag name>
```
作成したタグは、ブランチ名を指定するようにチェックアウトの際等に指定することができます。ただし、タグの命名はブランチ名と被っていても命名できます。どちらが参照されるかわからなくなるので、注意しましょう。
なお、タグはコミットをプッシュしただけではリモートに同期されません。リモートに同期する必要のあるタグの場合は次のコマンドでプッシュします。
```bash
git push <Tag name>
```
なお、一度プッシュしたタグは他の人にどのように使われているかわからないため、名前を変えたり、削除したりするべきではないので注意しましょう。<br>
ローカルにしかタグがない場合は削除しても影響するのは自分だけなので大丈夫です。<br>
タグを削除するには次のコマンドを実行します。
```bash
git tag --delete <Tag name>
```
ここまでで、GitHubをリモートリポジトリとして扱い、Gitを共同開発で使うための基本的なことを学びました。ここまでのことを軽くおさらいしましょう。
- GitHub認証の設定
- GitHubのリポジトリ設定
- Gitのブランチ名を変更する(git branch -m)
- GitHubにコードをアップロードする(git push)
- GitHubでコミットした内容と変更を確認する
- GitHubからソースコードを手元にコピーする(git clone)
- GitHubから変更を取得する(git fetch / git merge -> git pull)
- 変更が競合したら解決する(git checkout --ours / git checkout --theirs)
- 変更を一時退避させる(git stash)
- コミットにタグをつける(git tag)

お疲れ様でした！最後にGitHubのWeb上の機能や、チーム開発をする上でのベストプラクティスなどを確認しましょう！

## rebaseについて
今回のワークショップではrebaseを触れないで進めました。これは機能が少しややこしく、限られた時間の中では理解することが難しいと考えたためです。<br>
概要だけお話しておくと、rebaseはコミットをまとめたり、ブランチ統合の際に付け替えたりするものです。コミットを整理できるので、ログの整理に繋がります。しかし、使い方を誤ると、コミットが消失してしまい、チーム開発で混乱を招く恐れもあるコマンドです。<br>
必須級の機能ではないので、使わなくてもチーム開発でGitを使用することはできると思いますが、興味があったら調べてみてください。